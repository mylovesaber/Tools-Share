更新包要求更新时最完整的更新内容就是同时对tomcat和数据库进行修改:
tomcat:
往系统中写入一个改过配置的tomcat，里面包括了前后端文件夹还有sql文件，
install写到/tmp下，然后由postinst脚本移动到目标路径下防止未来更新的时候上一版本的tomcat被删掉了，
（为防重复安装相同版本的更新包导致tomcat配置出错，每次需要先删除/opt/anshare下的与更新包中的同名tomcat文件夹）
然后停止新增和上一版本以外的其他所有版本tomcat并删除配置，重启redis

mysql:
通过mysqldump备份出来上一版本的数据库的表和结构成sql文件，然后mysql登录后创建指定名称的新数据库
（为防重复安装相同版本的更新包导致数据库配置出错，每次需要先丢弃更新包中要创建的同名数据库）
先将上一版本备份出来的已经有数据的sql文件导入，然后再导入新的sql文件

install 也是拼接的
所以更新包中不应该存在卸载脚本，所有更新包安装或被覆盖安装时存在的卸载操作所需的全部后续处理应该全写在postinst脚本中

生成deb包需要的脚本时，tomcat和mysql配置均需要一个已经写好的postinst脚本，执行哪个操作就调用哪个脚本，如果两个都执行，那就将脚本进行拼接后移除多余shebang
提示打包时间过长，请耐心等待，

注意，后端只要更新时会更新sql，就一定要更新jdbc链接中的数据库名，否则不用动数据库名

---

# tomcat 不跳过
## 1.1 tomcat 不指定/双指定配置
生成 tomcat 模板

### 1.1.1 tomcat 前后端设置
#### 1.1.1.1 tomcat 前后端双指定
需要指定前后端文件夹名称，并把指定的前后端文件夹拷贝进新 tomcat 中

#### 1.1.1.2 tomcat 前后端不指定
前后端文件夹名称必须同时为空，source 文件夹内所有文件夹都复制进新生成的 tomcat 中

### 1.1.2 SQL 操作
#### 1.1.2.1 SQL 跳过
无操作

#### 1.1.2.2 SQL 指定
需要指定 sql 文件名称，并把指定的 sql 文件拷贝进新 tomcat 中

### 1.1.3 postinst 操作
将新 tomcat 放进对应路径，停止两个版本以前的所有 tomcat 版本并删除对应服务，最后删掉对应文件夹

- 如果 SQL 跳过，则无需任何操作。
- 如果 SQL 指定，则为指定的老数据库备份出 sql 文件，创建新数据库，把备份 sql 文件导入，再导入新 sql 文件

## 1.2 tomcat 单指定配置
生成 tomcat 模板

### 1.2.1 tomcat 前后端设置
#### 1.2.1.1 tomcat 前端指定
需要前端文件夹

#### 1.2.1.2 tomcat 后端指定
需要后端文件夹

### 1.2.2 SQL 操作
#### 1.2.2.1 SQL 跳过
无操作

#### 1.2.2.2 SQL 指定
需要指定 sql 文件名称，并把指定的 sql 文件拷贝进新 tomcat 中


### 1.2.3 postinst 操作

1. 将新 tomcat 放进对应路径
2. 将上一版本 tomcat 的 webapps 中除了其默认文件夹和 **指定文件夹名以外的文件夹** 复制到新 tomcat 中
3. 停止两个版本以前的所有 tomcat 版本并删除对应服务
4. 删掉对应文件夹

>1. 如果 SQL 跳过，则无需任何操作。
>2. 如果 SQL 指定 + 前端指定，则向指定老数据库导入新 sql 文件
>3. 如果 SQL 指定 + 后端指定，则为指定的老数据库备份出 sql 文件，创建新数据库，把备份 sql 文件导入，再导入新 sql 文件

build/"$packageSource"/"$packageSource"-"$packageVersion"/"$packageInsidePath"

# tomcat 跳过，sql 指定
目的: 清理前一版本出现的脏数据 or 增删改表

向指定老数据库导入新 sql 文件

# tomcat 和 sql 均跳过

工具应该停止工作，二者至少要启用一个

---

总结: 
1. 对于 tomcat 而言，只要前后端选项全指定或全不指定，postinst 中将不对上一版本做任何处理，但会删除当前和上一版本以外的所有版本
2. 只要前后端指定一个而另一个不指定，则将上一版本的 tomcat 的 webapps 中除了其默认文件夹和 **指定文件夹名以外的文件夹** 复制到新 tomcat 中，其他操作和第一点一样
3. 如果只指定前端且 sql 指定了，则只导入不备份
4. 如果只指定后端且 sql 指定了，则备份老数据库到 sql 文件，然后创建新数据库，然后先导入备份 sql 文件，然后导入新 sql 文件
5. mysql 选项是否使用均不会影响到 tomcat 的四种情形，而 tomcat 中的不同情形会影响到 mysql 的配置

---

# 测试

## 只更新前端OK
1. 看到新版本的前端，同时有上一版本的后端过来，不应该有其他操作

## 只更新后端OK
1. 看到新版本的后端，同时有上一版本的前端过来，不应该有其他操作

## 只更新数据库OK
1. 新sql被导入，不应该有新数据库被创建，不应该有新tomcat生成

## 前端+数据库
1. 看到新版本的前端，同时有上一版本的后端过来，同时新sql被导入，不应该有新数据库被创建

## 后端+数据库
1. 看到新版本的后端，同时有上一版本的前端过来，同时新版本数据库被创建

## 前端+后端OK
1. 看到新版本的前后端，不应该有其他操作

## 不指定前后端，文件夹全复制OK
1. 看到新版本的tomcat，不应该有其他操作

## 前后端+数据库OK
1. 看到新版本的tomcat中有新的前后端，有新版本数据库被创建

## 不指定前后端，文件夹全复制+数据库
1. 看到新版本的tomcat，有新版本数据库被创建

